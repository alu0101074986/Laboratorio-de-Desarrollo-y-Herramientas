<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Player.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">BatBat-Game</a> &gt; <a href="index.source.html" class="el_package">al.tonikolaba.entity</a> &gt; <span class="el_source">Player.java</span></div><h1>Player.java</h1><pre class="source lang-java linenums">package al.tonikolaba.entity;

import java.awt.Graphics2D;
import java.awt.Rectangle;
import java.awt.image.BufferedImage;
import java.util.ArrayList;
import java.util.List;
import java.util.logging.Level;

import javax.imageio.ImageIO;

import al.tonikolaba.audio.JukeBox;
import al.tonikolaba.handlers.LoggingHelper;
import al.tonikolaba.tilemap.TileMap;

/**
 * @author ArtOfSoul
 */

public class Player extends MapObject {

	public static final int NONE_EMOTE = 0;
	public static final int CONFUSED_EMOTE = 1;
	public static final int SURPRISED_EMOTE = 2;
<span class="fc" id="L25">	private static final int[] NUMFRAMES = { 1, 8, 5, 3, 3, 5, 3, 8, 2, 1, 3 };</span>
<span class="fc" id="L26">	private static final int[] FRAMEWIDTHS = { 40, 40, 80, 40, 40, 40, 80, 40, 40, 40, 40 };</span>
<span class="fc" id="L27">	private static final int[] FRAMEHEIGHTS = { 40, 40, 40, 40, 40, 80, 40, 40, 40, 40, 40 };</span>
<span class="fc" id="L28">	private static final int[] SPRITEDELAYS = { -1, 3, 2, 6, 5, 2, 2, 2, 1, -1, 1 };</span>
	// animation actions
	private static final int IDLE_ANIM = 0;
	private static final int WALKING_ANIM = 1;
	public static final int ATTACKING_ANIM = 2;
	private static final int JUMPING_ANIM = 3;
	private static final int FALLING_ANIM = 4;
	private static final int UPATTACKING_ANIM = 5;
	private static final int CHARGING_ANIM = 6;
	private static final int DASHING_ANIM = 7;
	private static final int KNOCKBACK_ANIM = 8;
	private static final int DEAD_ANIM = 9;
	private static final int TELEPORTING_ANIM = 10;
<span class="fc" id="L41">	public final String PLAYERJUMP_MUSIC_NAME = &quot;playerjump&quot;;</span>
<span class="fc" id="L42">	public final String PLAYERATTACK_MUSIC_NAME = &quot;playerattack&quot;;</span>
	// references
	private ArrayList&lt;Enemy&gt; enemies;
	// player stuff
	private int lives;
	private int health;
	private int maxHealth;
	private int damage;
	private int chargeDamage;
	private boolean knockback;
	private boolean flinching;
	private long flinchCount;
	private int score;
	private boolean doubleJump;
	private boolean alreadyDoubleJump;
	private double doubleJumpStart;
	private ArrayList&lt;EnergyParticle&gt; energyParticles;
	private long time;
	// actions
	private boolean dashing;
	public boolean attacking;
	public boolean upattacking;
	private boolean charging;
	private int chargingTick;
	private boolean teleporting;
	// animations
	private ArrayList&lt;BufferedImage[]&gt; sprites;
	private Rectangle ar;
	private Rectangle aur;
	private Rectangle cr;
	// emotes
	private BufferedImage confused;
	private BufferedImage surprised;
<span class="fc" id="L75">	private int emote = NONE_EMOTE;</span>

	public Player(TileMap tm) {

<span class="fc" id="L79">		super(tm);</span>

<span class="fc" id="L81">		ar = new Rectangle(0, 0, 0, 0);</span>
<span class="fc" id="L82">		ar.width = 30;</span>
<span class="fc" id="L83">		ar.height = 20;</span>
<span class="fc" id="L84">		aur = new Rectangle((int) x - 15, (int) y - 45, 30, 30);</span>
<span class="fc" id="L85">		cr = new Rectangle(0, 0, 0, 0);</span>
<span class="fc" id="L86">		cr.width = 50;</span>
<span class="fc" id="L87">		cr.height = 40;</span>

<span class="fc" id="L89">		width = 30;</span>
<span class="fc" id="L90">		height = 30;</span>
<span class="fc" id="L91">		cwidth = 15;</span>
<span class="fc" id="L92">		cheight = 38;</span>

<span class="fc" id="L94">		moveSpeed = 1.6;</span>
<span class="fc" id="L95">		maxSpeed = 1.6;</span>
<span class="fc" id="L96">		stopSpeed = 1.6;</span>
<span class="fc" id="L97">		fallSpeed = 0.15;</span>
<span class="fc" id="L98">		maxFallSpeed = 4.0;</span>
<span class="fc" id="L99">		jumpStart = -4.8;</span>
<span class="fc" id="L100">		stopJumpSpeed = 0.3;</span>
<span class="fc" id="L101">		doubleJumpStart = -3;</span>

<span class="fc" id="L103">		damage = 2;</span>
<span class="fc" id="L104">		chargeDamage = 1;</span>

<span class="fc" id="L106">		facingRight = true;</span>

<span class="fc" id="L108">		lives = 3;</span>
<span class="fc" id="L109">		health = maxHealth = 5;</span>

		// load sprites
		try {

<span class="fc" id="L114">			BufferedImage spritesheet = ImageIO</span>
<span class="fc" id="L115">					.read(getClass().getResourceAsStream(&quot;/Sprites/Player/BatterySpirtes.gif&quot;));</span>

<span class="fc" id="L117">			int count = 0;</span>
<span class="fc" id="L118">			sprites = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L119" title="All 2 branches covered.">			for (int i = 0; i &lt; NUMFRAMES.length; i++) {</span>
<span class="fc" id="L120">				BufferedImage[] bi = new BufferedImage[NUMFRAMES[i]];</span>
<span class="fc bfc" id="L121" title="All 2 branches covered.">				for (int j = 0; j &lt; NUMFRAMES[i]; j++) {</span>
<span class="fc" id="L122">					bi[j] = spritesheet.getSubimage(j * FRAMEWIDTHS[i], count, FRAMEWIDTHS[i], FRAMEHEIGHTS[i]);</span>
				}
<span class="fc" id="L124">				sprites.add(bi);</span>
<span class="fc" id="L125">				count += FRAMEHEIGHTS[i];</span>
			}

			// emotes
<span class="fc" id="L129">			spritesheet = ImageIO.read(getClass().getResourceAsStream(&quot;/HUD/Emotes.gif&quot;));</span>
<span class="fc" id="L130">			confused = spritesheet.getSubimage(0, 0, 14, 17);</span>
<span class="fc" id="L131">			surprised = spritesheet.getSubimage(14, 0, 14, 17);</span>

<span class="nc" id="L133">		} catch (Exception e) {</span>
<span class="nc" id="L134">			LoggingHelper.LOGGER.log(Level.SEVERE, e.getMessage());</span>
<span class="fc" id="L135">		}</span>

<span class="fc" id="L137">		energyParticles = new ArrayList&lt;&gt;();</span>

<span class="fc" id="L139">		setAnimation(IDLE_ANIM);</span>

<span class="fc" id="L141">		JukeBox.load(&quot;/SFX/playerlands.mp3&quot;, &quot;playerlands&quot;);</span>
<span class="fc" id="L142">		JukeBox.load(&quot;/SFX/playerattack.mp3&quot;, PLAYERATTACK_MUSIC_NAME);</span>
<span class="fc" id="L143">		JukeBox.load(&quot;/SFX/playerhit.mp3&quot;, &quot;playerhit&quot;);</span>
<span class="fc" id="L144">		JukeBox.load(&quot;/SFX/playercharge.mp3&quot;, &quot;playercharge&quot;);</span>

<span class="fc" id="L146">	}</span>

	public void init(List&lt;Enemy&gt; enemies, List&lt;EnergyParticle&gt; energyParticles) {
<span class="fc" id="L149">		this.enemies = (ArrayList&lt;Enemy&gt;) enemies;</span>
<span class="fc" id="L150">		this.energyParticles = (ArrayList&lt;EnergyParticle&gt;) energyParticles;</span>
<span class="fc" id="L151">	}</span>

	public int getHealth() {
<span class="nc" id="L154">		return health;</span>
	}

	public void setHealth(int i) {
<span class="fc" id="L158">		health = i;</span>
<span class="fc" id="L159">	}</span>

	public int getMaxHealth() {
<span class="nc" id="L162">		return maxHealth;</span>
	}

	public void setEmote(int i) {
<span class="nc" id="L166">		emote = i;</span>
<span class="nc" id="L167">	}</span>

	public void setTeleporting(boolean b) {
<span class="nc" id="L170">		teleporting = b;</span>
<span class="nc" id="L171">	}</span>

	@Override
	public void setJumping(boolean b) {
<span class="nc bnc" id="L175" title="All 2 branches missed.">		if (knockback)</span>
<span class="nc" id="L176">			return;</span>
<span class="nc bnc" id="L177" title="All 8 branches missed.">		if (b &amp;&amp; !jumping &amp;&amp; falling &amp;&amp; !alreadyDoubleJump) {</span>
<span class="nc" id="L178">			doubleJump = true;</span>
		}
<span class="nc" id="L180">		jumping = b;</span>
<span class="nc" id="L181">	}</span>

	public void setAttacking() {
<span class="pc bpc" id="L184" title="1 of 2 branches missed.">		if (knockback)</span>
<span class="nc" id="L185">			return;</span>
<span class="pc bpc" id="L186" title="1 of 2 branches missed.">		if (charging)</span>
<span class="nc" id="L187">			return;</span>
<span class="pc bpc" id="L188" title="3 of 4 branches missed.">		if (up &amp;&amp; !attacking)</span>
<span class="nc" id="L189">			upattacking = true;</span>
		else
<span class="fc" id="L191">			attacking = true;</span>
<span class="fc" id="L192">	}</span>

	public void setCharging() {
<span class="nc bnc" id="L195" title="All 2 branches missed.">		if (knockback)</span>
<span class="nc" id="L196">			return;</span>
<span class="nc bnc" id="L197" title="All 6 branches missed.">		if (!attacking &amp;&amp; !upattacking &amp;&amp; !charging) {</span>
<span class="nc" id="L198">			charging = true;</span>
<span class="nc" id="L199">			JukeBox.play(&quot;playercharge&quot;);</span>
<span class="nc" id="L200">			chargingTick = 0;</span>
		}
<span class="nc" id="L202">	}</span>

	public boolean isDashing() {
<span class="nc" id="L205">		return dashing;</span>
	}

	public void setDashing(boolean b) {
<span class="nc bnc" id="L209" title="All 2 branches missed.">		if (!b)</span>
<span class="nc" id="L210">			dashing = false;</span>
<span class="nc bnc" id="L211" title="All 2 branches missed.">		else if (!falling) {</span>
<span class="nc" id="L212">			dashing = true;</span>
		}
<span class="nc" id="L214">	}</span>

	public void setDead() {
<span class="nc" id="L217">		health = 0;</span>
<span class="nc" id="L218">		stop();</span>
<span class="nc" id="L219">	}</span>

	public String getTimeToString() {
<span class="fc" id="L222">		int minutes = (int) (time / 3600);</span>
<span class="fc" id="L223">		int seconds = (int) ((time % 3600) / 60);</span>
<span class="pc bpc" id="L224" title="1 of 2 branches missed.">		return seconds &lt; 10 ? minutes + &quot;:0&quot; + seconds : minutes + &quot;:&quot; + seconds;</span>
	}

	public long getTime() {
<span class="nc" id="L228">		return time;</span>
	}

	public void setTime(long t) {
<span class="fc" id="L232">		time = t;</span>
<span class="fc" id="L233">	}</span>

	public void gainLife() {
<span class="nc" id="L236">		lives++;</span>
<span class="nc" id="L237">	}</span>

	public void loseLife() {
<span class="nc" id="L240">		lives--;</span>
<span class="nc" id="L241">	}</span>

	public int getLives() {
<span class="nc" id="L244">		return lives;</span>
	}

	public void setLives(int i) {
<span class="fc" id="L248">		lives = i;</span>
<span class="fc" id="L249">	}</span>

	public void increaseScore(int score) {
<span class="nc" id="L252">		this.score += score;</span>
<span class="nc" id="L253">	}</span>

	public int getScore() {
<span class="nc" id="L256">		return score;</span>
	}

	public void hit(int damage) {
<span class="pc bpc" id="L260" title="1 of 2 branches missed.">		if (flinching)</span>
<span class="nc" id="L261">			return;</span>
		// JukeBox.load(&quot;/SFX/playerhit.mp3&quot;, &quot;playerhit&quot;);
		// Clip c = clips.get(s);
		// JukeBox.play(&quot;playerhit&quot;, 2);
<span class="fc" id="L265">		stop();</span>
<span class="fc" id="L266">		health -= damage;</span>
<span class="pc bpc" id="L267" title="1 of 2 branches missed.">		if (health &lt; 0)</span>
<span class="nc" id="L268">			health = 0;</span>
<span class="fc" id="L269">		flinching = true;</span>
<span class="fc" id="L270">		flinchCount = 0;</span>
<span class="pc bpc" id="L271" title="1 of 2 branches missed.">		if (facingRight)</span>
<span class="fc" id="L272">			dx = -1;</span>
		else
<span class="nc" id="L274">			dx = 1;</span>
<span class="fc" id="L275">		dy = -3;</span>
<span class="fc" id="L276">		knockback = true;</span>
<span class="fc" id="L277">		falling = true;</span>
<span class="fc" id="L278">		jumping = false;</span>
<span class="fc" id="L279">	}</span>

	public void reset() {
<span class="nc" id="L282">		health = maxHealth;</span>
<span class="nc" id="L283">		facingRight = true;</span>
<span class="nc" id="L284">		currentAction = -1;</span>
<span class="nc" id="L285">		stop();</span>
<span class="nc" id="L286">	}</span>

	public void stop() {
<span class="fc" id="L289">		left = right = up = down = flinching = dashing = jumping = attacking = upattacking = charging = false;</span>
<span class="fc" id="L290">	}</span>

	public void getNextPosition() {

<span class="fc bfc" id="L294" title="All 2 branches covered.">		if (knockback) {</span>
<span class="fc" id="L295">			dy += fallSpeed * 2;</span>
<span class="pc bpc" id="L296" title="1 of 2 branches missed.">			knockback = !falling;</span>
<span class="fc" id="L297">			return;</span>
		}

<span class="fc" id="L300">		movement();</span>

<span class="fc" id="L302">		jumpAndFall();</span>

<span class="fc" id="L304">	}</span>

	private void jumpAndFall() {
		// jumping
<span class="pc bpc" id="L308" title="3 of 4 branches missed.">		if (jumping &amp;&amp; !falling) {</span>
<span class="nc" id="L309">			dy = jumpStart;</span>
<span class="nc" id="L310">			falling = true;</span>
<span class="nc" id="L311">			JukeBox.play(PLAYERJUMP_MUSIC_NAME);</span>
		}

<span class="pc bpc" id="L314" title="1 of 2 branches missed.">		if (doubleJump) {</span>
<span class="nc" id="L315">			dy = doubleJumpStart;</span>
<span class="nc" id="L316">			alreadyDoubleJump = true;</span>
<span class="nc" id="L317">			doubleJump = false;</span>
<span class="nc" id="L318">			JukeBox.play(PLAYERJUMP_MUSIC_NAME);</span>
<span class="nc bnc" id="L319" title="All 2 branches missed.">			for (int i = 0; i &lt; 6; i++) {</span>
<span class="nc" id="L320">				energyParticles.add(new EnergyParticle(tileMap, x, y + cheight / 4.0, EnergyParticle.ENERGY_DOWN));</span>
			}
		}

<span class="pc bpc" id="L324" title="1 of 2 branches missed.">		if (!falling)</span>
<span class="fc" id="L325">			alreadyDoubleJump = false;</span>

		// falling
<span class="pc bpc" id="L328" title="1 of 2 branches missed.">		if (falling) {</span>
<span class="nc" id="L329">			dy += fallSpeed;</span>
<span class="nc bnc" id="L330" title="All 4 branches missed.">			if (dy &lt; 0 &amp;&amp; !jumping)</span>
<span class="nc" id="L331">				dy += stopJumpSpeed;</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">			if (dy &gt; maxFallSpeed)</span>
<span class="nc" id="L333">				dy = maxFallSpeed;</span>
		}
<span class="fc" id="L335">	}</span>

	private void movement() {
<span class="fc" id="L338">		double maxSpeed = this.maxSpeed;</span>
<span class="pc bpc" id="L339" title="1 of 2 branches missed.">		if (dashing)</span>
<span class="nc" id="L340">			maxSpeed *= 1.75;</span>

		// movement
<span class="pc bpc" id="L343" title="1 of 2 branches missed.">		if (left) {</span>
<span class="nc" id="L344">			dx = Math.max(-maxSpeed, dx - moveSpeed);</span>
<span class="pc bpc" id="L345" title="1 of 2 branches missed.">		} else if (right) {</span>
<span class="nc" id="L346">			dx = Math.min(maxSpeed, dx + moveSpeed);</span>
		} else {
<span class="pc bpc" id="L348" title="1 of 2 branches missed.">			if (dx &gt;= 0) {</span>
<span class="fc" id="L349">				dx = Math.max(0, dx - stopSpeed);</span>
			} else {
<span class="nc" id="L351">				dx = Math.min(0, dx + stopSpeed);</span>
			}
		}

		// cannot move while attacking, except in air
<span class="pc bpc" id="L356" title="7 of 10 branches missed.">		if ((attacking || upattacking || charging) &amp;&amp; !(jumping || falling)) {</span>
<span class="nc" id="L357">			dx = 0;</span>
		}

		// charging
<span class="pc bpc" id="L361" title="1 of 2 branches missed.">		if (charging) {</span>
<span class="nc" id="L362">			chargingTick++;</span>
<span class="nc bnc" id="L363" title="All 2 branches missed.">			if (facingRight)</span>
<span class="nc" id="L364">				dx = moveSpeed * (3 - chargingTick * 0.07);</span>
			else
<span class="nc" id="L366">				dx = -moveSpeed * (3 - chargingTick * 0.07);</span>
		}
<span class="fc" id="L368">	}</span>

	private void setAnimation(int i) {
<span class="pc bpc" id="L371" title="1 of 2 branches missed.">		if (currentAction != i) {</span>
<span class="fc" id="L372">			currentAction = i;</span>
<span class="fc" id="L373">			animation.setFrames(sprites.get(currentAction));</span>
<span class="fc" id="L374">			animation.setDelay(SPRITEDELAYS[currentAction]);</span>
<span class="fc" id="L375">			width = FRAMEWIDTHS[currentAction];</span>
<span class="fc" id="L376">			height = FRAMEHEIGHTS[currentAction];</span>
		}
<span class="fc" id="L378">	}</span>

	public void update() {

<span class="nc" id="L382">		time++;</span>

		// check teleporting
<span class="nc bnc" id="L385" title="All 2 branches missed.">		if (teleporting) {</span>
<span class="nc" id="L386">			energyParticles.add(new EnergyParticle(tileMap, x, y, EnergyParticle.ENERGY_UP));</span>
		}

		// update position
<span class="nc" id="L390">		boolean isFalling = falling;</span>
<span class="nc" id="L391">		getNextPosition();</span>
<span class="nc" id="L392">		checkTileMapCollision();</span>
<span class="nc" id="L393">		setPosition(xtemp, ytemp);</span>
<span class="nc bnc" id="L394" title="All 4 branches missed.">		if (isFalling &amp;&amp; !falling) {</span>
<span class="nc" id="L395">			JukeBox.play(&quot;playerlands&quot;);</span>
		}
<span class="nc bnc" id="L397" title="All 2 branches missed.">		if (dx == 0)</span>
<span class="nc" id="L398">			x = (int) x;</span>

<span class="nc" id="L400">		checkAttack();</span>

<span class="nc" id="L402">		checkEnemyInteraction();</span>

<span class="nc" id="L404">		checkAnimations();</span>

<span class="nc" id="L406">		animation.update();</span>

		// set direction
<span class="nc bnc" id="L409" title="All 8 branches missed.">		if (!attacking &amp;&amp; !upattacking &amp;&amp; !charging &amp;&amp; !knockback) {</span>
<span class="nc bnc" id="L410" title="All 2 branches missed.">			if (right)</span>
<span class="nc" id="L411">				facingRight = true;</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">			if (left)</span>
<span class="nc" id="L413">				facingRight = false;</span>
		}

<span class="nc" id="L416">	}</span>

	private void checkAttack() {
		// check done flinching
<span class="nc bnc" id="L420" title="All 2 branches missed.">		if (flinching) {</span>
<span class="nc" id="L421">			flinchCount++;</span>
<span class="nc bnc" id="L422" title="All 2 branches missed.">			flinching = flinchCount &lt;= 120;</span>
		}

		// energy particles
<span class="nc" id="L426">		ArrayList&lt;EnergyParticle&gt; particlesToRemove = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L427" title="All 2 branches missed.">		for (int i = 0; i &lt; energyParticles.size(); i++) {</span>
<span class="nc" id="L428">			energyParticles.get(i).update();</span>
<span class="nc bnc" id="L429" title="All 2 branches missed.">			if (energyParticles.get(i).shouldRemove()) {</span>
<span class="nc" id="L430">				particlesToRemove.add(energyParticles.get(i));</span>
			}
		}

<span class="nc bnc" id="L434" title="All 2 branches missed.">		for (EnergyParticle e : particlesToRemove) {</span>
<span class="nc" id="L435">			energyParticles.remove(e);</span>
<span class="nc" id="L436">		}</span>

		// check attack finished
<span class="nc bnc" id="L439" title="All 6 branches missed.">		if ((currentAction == ATTACKING_ANIM || currentAction == UPATTACKING_ANIM) &amp;&amp; animation.hasPlayedOnce()) {</span>
<span class="nc" id="L440">			attacking = false;</span>
<span class="nc" id="L441">			upattacking = false;</span>
		}
<span class="nc bnc" id="L443" title="All 2 branches missed.">		if (currentAction == CHARGING_ANIM) {</span>
<span class="nc bnc" id="L444" title="All 2 branches missed.">			if (animation.hasPlayed(5)) {</span>
<span class="nc" id="L445">				charging = false;</span>
			}
<span class="nc" id="L447">			cr.y = (int) y - 20;</span>
<span class="nc bnc" id="L448" title="All 2 branches missed.">			if (facingRight) {</span>
<span class="nc" id="L449">				cr.x = (int) x - 15;</span>
<span class="nc" id="L450">				energyParticles.add(new EnergyParticle(tileMap, x + 30, y, EnergyParticle.ENERGY_RIGHT));</span>
			} else {
<span class="nc" id="L452">				cr.x = (int) x - 35;</span>
<span class="nc" id="L453">				energyParticles.add(new EnergyParticle(tileMap, x - 30, y, EnergyParticle.ENERGY_LEFT));</span>
			}

		}
<span class="nc" id="L457">	}</span>

	private void checkEnemyInteraction() {
		// check enemy interaction
<span class="nc bnc" id="L461" title="All 2 branches missed.">		for (int i = 0; i &lt; enemies.size(); i++) {</span>

<span class="nc" id="L463">			Enemy e = enemies.get(i);</span>

			// check attack
<span class="nc bnc" id="L466" title="All 6 branches missed.">			if (currentAction == ATTACKING_ANIM &amp;&amp; animation.getFrame() == 3 &amp;&amp; animation.getCount() == 0</span>
<span class="nc bnc" id="L467" title="All 2 branches missed.">					&amp;&amp; e.intersects(ar)) {</span>
<span class="nc" id="L468">				e.hit(damage);</span>
			}

			// check upward attack
<span class="nc bnc" id="L472" title="All 6 branches missed.">			if (currentAction == UPATTACKING_ANIM &amp;&amp; animation.getFrame() == 3 &amp;&amp; animation.getCount() == 0</span>
<span class="nc bnc" id="L473" title="All 2 branches missed.">					&amp;&amp; e.intersects(aur)) {</span>
<span class="nc" id="L474">				e.hit(damage);</span>
			}

			// check charging attack
<span class="nc bnc" id="L478" title="All 6 branches missed.">			if (currentAction == CHARGING_ANIM &amp;&amp; animation.getCount() == 0 &amp;&amp; e.intersects(cr)) {</span>
<span class="nc" id="L479">				e.hit(chargeDamage);</span>
			}

			// collision with enemy
<span class="nc bnc" id="L483" title="All 6 branches missed.">			if (!e.isDead() &amp;&amp; intersects(e) &amp;&amp; !charging) {</span>
<span class="nc" id="L484">				hit(e.getDamage());</span>
			}

<span class="nc bnc" id="L487" title="All 2 branches missed.">			if (e.isDead()) {</span>
<span class="nc" id="L488">				JukeBox.play(&quot;explode&quot;, 2000);</span>
			}

		}
<span class="nc" id="L492">	}</span>

	private void checkAnimations() {
		// set animation, ordered by priority
<span class="nc bnc" id="L496" title="All 2 branches missed.">		if (teleporting) {</span>
<span class="nc" id="L497">			setAnimation(TELEPORTING_ANIM);</span>
<span class="nc bnc" id="L498" title="All 2 branches missed.">		} else if (knockback) {</span>
<span class="nc" id="L499">			setAnimation(KNOCKBACK_ANIM);</span>
<span class="nc bnc" id="L500" title="All 2 branches missed.">		} else if (health == 0) {</span>
<span class="nc" id="L501">			setAnimation(DEAD_ANIM);</span>
<span class="nc bnc" id="L502" title="All 2 branches missed.">		} else if (upattacking) {</span>
<span class="nc" id="L503">			checkUpAttackingAnim();</span>
<span class="nc bnc" id="L504" title="All 2 branches missed.">		} else if (attacking) {</span>
<span class="nc" id="L505">			checkAttackingAnim();</span>
<span class="nc bnc" id="L506" title="All 2 branches missed.">		} else if (charging) {</span>
<span class="nc" id="L507">			setAnimation(CHARGING_ANIM);</span>
<span class="nc bnc" id="L508" title="All 2 branches missed.">		} else if (dy &lt; 0) {</span>
<span class="nc" id="L509">			setAnimation(JUMPING_ANIM);</span>
<span class="nc bnc" id="L510" title="All 2 branches missed.">		} else if (dy &gt; 0) {</span>
<span class="nc" id="L511">			setAnimation(FALLING_ANIM);</span>
<span class="nc bnc" id="L512" title="All 6 branches missed.">		} else if (dashing &amp;&amp; (left || right)) {</span>
<span class="nc" id="L513">			setAnimation(DASHING_ANIM);</span>
<span class="nc bnc" id="L514" title="All 4 branches missed.">		} else if (left || right) {</span>
<span class="nc" id="L515">			setAnimation(WALKING_ANIM);</span>
		} else {
<span class="nc" id="L517">			setAnimation(IDLE_ANIM);</span>
		}
<span class="nc" id="L519">	}</span>

	private void checkAttackingAnim() {
<span class="nc bnc" id="L522" title="All 2 branches missed.">		if (currentAction != ATTACKING_ANIM) {</span>
<span class="nc" id="L523">			JukeBox.play(PLAYERATTACK_MUSIC_NAME);</span>
<span class="nc" id="L524">			setAnimation(ATTACKING_ANIM);</span>
<span class="nc" id="L525">			ar.y = (int) y - 6;</span>
<span class="nc bnc" id="L526" title="All 2 branches missed.">			ar.x = facingRight ? (int) x + 10 : (int) x - 40;</span>
		} else {
<span class="nc bnc" id="L528" title="All 4 branches missed.">			if (animation.getFrame() == 4 &amp;&amp; animation.getCount() == 0) {</span>
<span class="nc bnc" id="L529" title="All 2 branches missed.">				for (int c = 0; c &lt; 3; c++) {</span>
<span class="nc bnc" id="L530" title="All 2 branches missed.">					if (facingRight) {</span>
<span class="nc" id="L531">						energyParticles.add(new EnergyParticle(</span>
								tileMap,
								(double) (ar.x + ar.width - 4),
								(double) (ar.y + (double) ar.height / 2),  // Casting to double for precise division
								EnergyParticle.ENERGY_RIGHT
						));
					} else {
<span class="nc" id="L538">						energyParticles.add(new EnergyParticle(</span>
								tileMap,
								(double) (ar.x + 4),
								(double) (ar.y + (double) ar.height / 2),  // Casting to double for precise division
								EnergyParticle.ENERGY_LEFT
						));
					}
				}
			}
		}
<span class="nc" id="L548">	}</span>


	private void checkUpAttackingAnim() {
<span class="nc bnc" id="L552" title="All 2 branches missed.">		if (currentAction != UPATTACKING_ANIM) {</span>
<span class="nc" id="L553">			JukeBox.play(PLAYERATTACK_MUSIC_NAME);</span>
<span class="nc" id="L554">			setAnimation(UPATTACKING_ANIM);</span>
<span class="nc" id="L555">			aur.x = (int) x - 15;</span>
<span class="nc" id="L556">			aur.y = (int) y - 50;</span>
		} else {
<span class="nc bnc" id="L558" title="All 4 branches missed.">			if (animation.getFrame() == 4 &amp;&amp; animation.getCount() == 0) {</span>
<span class="nc bnc" id="L559" title="All 2 branches missed.">				for (int c = 0; c &lt; 3; c++) {</span>
<span class="nc" id="L560">					energyParticles.add(new EnergyParticle(</span>
							tileMap,
							(double) (aur.x + (double) aur.width / 2), // Casting one operand to double for precise division
							(double) (aur.y + 5),                      // Casting to double for addition
							EnergyParticle.ENERGY_UP
					));
				}
			}
		}
<span class="nc" id="L569">	}</span>

	@Override
	public void draw(Graphics2D g) {

		// draw emote
<span class="nc bnc" id="L575" title="All 2 branches missed.">		if (emote == CONFUSED_EMOTE) {</span>
<span class="nc" id="L576">			g.drawImage(confused, (int) (x + xmap - cwidth / 2.0), (int) (y + ymap - 40), null);</span>
<span class="nc bnc" id="L577" title="All 2 branches missed.">		} else if (emote == SURPRISED_EMOTE) {</span>
<span class="nc" id="L578">			g.drawImage(surprised, (int) (x + xmap - cwidth / 2.0), (int) (y + ymap - 40), null);</span>
		}

		// draw energy particles
<span class="nc bnc" id="L582" title="All 2 branches missed.">		for (int i = 0; i &lt; energyParticles.size(); i++) {</span>
<span class="nc" id="L583">			energyParticles.get(i).draw(g);</span>
		}

		// flinch
<span class="nc bnc" id="L587" title="All 6 branches missed.">		if (flinching &amp;&amp; !knockback &amp;&amp; flinchCount % 10 &lt; 5) {</span>
<span class="nc" id="L588">			return;</span>
		}

<span class="nc" id="L591">		super.draw(g);</span>

<span class="nc" id="L593">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>